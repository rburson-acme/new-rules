#═══════════════════════════════════════════════════════════════════════════════
# Production Environment Configuration
#═══════════════════════════════════════════════════════════════════════════════
# This file provides production-specific overrides for the base config-registry
#
# Purpose: Production environment for live traffic
# Target: Azure AKS, AWS EKS, or GCP GKE
# Characteristics: High availability, auto-scaling, comprehensive monitoring
#═══════════════════════════════════════════════════════════════════════════════

environment:
  name: production
  description: "Production environment for live traffic"
  cloud:
    provider: azure
    region: eastus

# Image configuration
images:
  registry: srvthredsprodacr.azurecr.io
  tag: v${VERSION}  # Semantic versioning
  pullPolicy: IfNotPresent

# Service-specific overrides
services:
  engine:
    replicas: 3  # High availability
    resources:
      memory:
        request: 1Gi
        limit: 2Gi
      cpu:
        request: 1000m
        limit: 2000m
    environment:
      LOG_LEVEL: warn
      NODE_ENV: production
    # Pod disruption budget for high availability
    podDisruptionBudget:
      minAvailable: 2

  session-agent:
    replicas: 3
    resources:
      memory:
        request: 512Mi
        limit: 1Gi
      cpu:
        request: 500m
        limit: 1000m
    environment:
      LOG_LEVEL: warn
      NODE_ENV: production
    podDisruptionBudget:
      minAvailable: 2

  persistence-agent:
    replicas: 3
    resources:
      memory:
        request: 1Gi
        limit: 2Gi
      cpu:
        request: 800m
        limit: 1600m
    environment:
      LOG_LEVEL: warn
      NODE_ENV: production
    podDisruptionBudget:
      minAvailable: 2

# Cloud-specific managed services
cloud:
  azure:
    cosmosdb:
      tier: "Standard"
      throughput: 4000
      enableAutoscale: true
      maxThroughput: 10000
    redis:
      sku: "Premium"
      capacity: 1  # P1
      enableNonSslPort: false
      replicaCount: 2
    aks:
      nodeCount: 5
      vmSize: "Standard_D4s_v3"
      enableAutoScaling: true
      minCount: 3
      maxCount: 15
      # Multiple node pools for different workload types
      nodePools:
        - name: "system"
          vmSize: "Standard_D2s_v3"
          count: 3
        - name: "workload"
          vmSize: "Standard_D4s_v3"
          count: 3
          minCount: 2
          maxCount: 12

  aws:
    documentdb:
      instanceClass: "db.r5.xlarge"
      instanceCount: 3
      multiAZ: true
      backupRetentionPeriod: 30
    elasticache:
      nodeType: "cache.m5.large"
      numCacheNodes: 3
      automaticFailoverEnabled: true
      multiAZ: true
    amazonmq:
      deploymentMode: "ACTIVE_STANDBY_MULTI_AZ"
      instanceType: "mq.m5.large"
    eks:
      version: "1.28"
      nodeGroupInstanceTypes:
        - "m5.xlarge"
      desiredSize: 5
      minSize: 3
      maxSize: 15

  gcp:
    mongodb:
      tier: "M30"
      replicationFactor: 3
      autoScaling: true
    memorystore:
      tier: "STANDARD_HA"
      memorySizeGb: 5
      replicaCount: 2
    gke:
      nodeCount: 5
      machineType: "e2-standard-4"
      enableAutoscaling: true
      minNodeCount: 3
      maxNodeCount: 15
      # Multiple node pools
      nodePools:
        - name: "system"
          machineType: "e2-standard-2"
          nodeCount: 3
        - name: "workload"
          machineType: "e2-standard-4"
          nodeCount: 3
          minNodeCount: 2
          maxNodeCount: 12

# Monitoring (comprehensive)
monitoring:
  enabled: true
  prometheus:
    enabled: true
    retention: "90d"
    highAvailability: true
  grafana:
    enabled: true
    highAvailability: true
  logging:
    retention: "90d"
    archival: "1y"
  tracing:
    enabled: true
    samplingRate: 0.1  # 10% sampling
  alerting:
    enabled: true
    channels:
      - email
      - slack
      - pagerduty

# Autoscaling (aggressive)
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 15
  targetCPUUtilization: 60
  targetMemoryUtilization: 70
  scaleDownStabilizationWindowSeconds: 300  # 5 minutes
  scaleUpStabilizationWindowSeconds: 60     # 1 minute

# Backup (comprehensive)
backup:
  enabled: true
  schedule: "0 1 * * *"  # Daily at 1 AM
  retention: "90d"
  archival: "1y"
  pointInTimeRecovery: true
  crossRegionReplication: true

# Security (enhanced)
security:
  networkPolicies: true
  podSecurityPolicies: true
  serviceAccounts:
    createPerService: true
  tls:
    enabled: true
    provider: "cert-manager"
  secretsEncryption:
    enabled: true
