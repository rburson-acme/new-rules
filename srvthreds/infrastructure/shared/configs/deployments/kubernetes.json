{
  "deployments": [
    {
      "name": "Deploy to Minikube",
      "shortName": "k8s_minikube",
      "description": "Deploy services to Minikube Kubernetes cluster",
      "environments": [
        "minikube"
      ],
      "target": {
        "type": "sh",
        "composing": "kubernetes",
        "deployCommand": "infrastructure/local/minikube/scripts/setup-minikube.sh"
      }
    },
    {
      "name": "Validate Minikube Deployment",
      "shortName": "k8s_validate",
      "description": "Validate minikube is setup correctly by evaluating pods and running tests",
      "environments": [
        "minikube"
      ],
      "target": {
        "type": "sh",
        "composing": "kubernetes",
        "deployCommand": "infrastructure/local/minikube/scripts/validate-minikube.sh",
        "preBuildCommands": [
          {
            "description": "Get running pods and recent logs for engine service...",
            "command": "kubectl get pods -n srvthreds && kubectl logs deployment/srvthreds-engine -n srvthreds --tail=50"
          }
        ]
      }
    },
    {
      "name": "Apply Kubernetes Manifests to Minikube",
      "shortName": "k8s_apply",
      "description": "Apply Kubernetes manifests using kubectl (Minikube must be running)",
      "environments": [
        "minikube"
      ],
      "target": {
        "type": "kubectl",
        "composing": "kubernetes",
        "deployCommand": "apply",
        "defaultArgs": "-k infrastructure/local/minikube/manifests/minikube/",
        "preBuildCommands": [
          {
            "description": "Switching kubectl context to Minikube...",
            "command": "infrastructure/local/minikube/scripts/switch-to-minikube.sh"
          }
        ]
      }
    },
    {
      "name": "Set Kubernetes Context to Minikube",
      "shortName": "set_context",
      "description": "Set Kubernetes Context to Minikube",
      "environments": [
        "minikube"
      ],
      "target": {
        "type": "sh",
        "composing": "kubernetes",
         "deployCommand": "infrastructure/local/minikube/scripts/switch-to-minikube.sh"
      }
    },
    {
      "name": "Reset Minikube Deployment",
      "shortName": "k8s_reset",
      "description": "Reset Minikube deployment (deletes namespace, keeps cluster running)",
      "environments": [
        "minikube"
      ],
      "target": {
        "type": "sh",
        "composing": "kubernetes",
        "deployCommand": "infrastructure/local/minikube/scripts/reset-minikube.sh"
      }
    },
    {
      "name": "Full Cleanup Minikube",
      "shortName": "k8s_cleanup",
      "description": "Complete cleanup: deletes cluster, resources, and optionally databases",
      "environments": [
        "minikube"
      ],
      "target": {
        "type": "sh",
        "composing": "kubernetes",
        "deployCommand": "infrastructure/local/minikube/scripts/cleanup-minikube.sh"
      }
    }
  ]
}
