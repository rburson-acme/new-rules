import { useEventManager } from '@/hooks/useEventManager';
import { useEffect, useState } from 'react';
import { PawprintIcon } from '../icons/PawprintIcon';
import { Event, EventBuilder } from 'thredlib';
import { SpotEvent } from '../events/SpotEvent';
import Image from 'next/image';

export function SpotMap() {
  const eventManager = useEventManager();
  const [events, setEvents] = useState<Event[]>([]);
  useEffect(() => {
    eventManager.subscribe(event => {
      setEvents([...events, event]);
    });
  });

  const onMapClick = (event: Event, location: google.maps.LatLng) => {
    eventManager.publish(
      EventBuilder.create({
        type: 'robot0',
        source: { id: 'robot0', name: 'Spot' },
        re: event.id,
        thredId: event.thredId,
      })
        .mergeValues({
          latitude: location.lat(),
          longitude: location.lng(),
          robotId: 'robot_id_0',
          videoStreamUrl: 'https://videos.pexels.com/video-files/3764259/3764259-hd_1280_720_60fps.mp4',
        })
        .build(),
    );
  };

  return (
    <div>
      <div className="flex flex-col items-center justify-center gap-4">
        <h1 className="text-2xl">Spot Client Map</h1>
        <Image
          src={
            'data:image/jpeg;base64,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'
          }
          alt="Spot"
          width={300}
          height={300}
        />
        {events.map(event => {
          return <SpotEvent onSelect={onMapClick} key={event.id} event={event} />;
        })}
      </div>
    </div>
  );
}
